!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.tiresias=t():e.tiresias=t()}(window,(function(){return function(e){var t={};function s(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=79)}({10:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QueryFrameIdResponseMessage=t.DispatchIframeExportReportMessage=t.SetHeavyDocumentInboundMessage=t.IframeReportMessageToParentFrame=t.TagLanguageResponseMessage=t.AllParametersMessage=t.DebugMessage=t.ClassifyMessage=void 0;class r{constructor(){this.msg=r.MSG}}t.ClassifyMessage=r,r.MSG="classify";class n{constructor(){this.msg=n.MSG}}t.DebugMessage=n,n.MSG="debug";class i{constructor(){this.msg=i.MSG}}t.AllParametersMessage=i,i.MSG="allParameters";class l{constructor(){this.msg=l.MSG}}t.TagLanguageResponseMessage=l,l.MSG="tabLanguage";class o{constructor(){this.msg=o.MSG}}t.IframeReportMessageToParentFrame=o,o.MSG="responseFrameIdToTopmostFrame";class a{constructor(){this.msg=a.MSG}}t.SetHeavyDocumentInboundMessage=a,a.MSG="setHeavyDocument";class u{constructor(e){this.report=e,this.msg=u.MSG}}t.DispatchIframeExportReportMessage=u,u.MSG="dispatchIframeExportReportMessage";class c{constructor(){this.msg=c.MSG}}t.QueryFrameIdResponseMessage=c,c.MSG="queryFrameIdResponse"},11:function(e,t,s){"use strict";function r(e){return null===e?"":e}Object.defineProperty(t,"__esModule",{value:!0}),t.getLocale=t.wordFrequencyCountBinary=t.wordFrequencyCount=t.buildVectorFromMap=t.nullToEmptyString=void 0,t.nullToEmptyString=r,t.buildVectorFromMap=function(e,t){const s=new Array(t.length).fill(0);return e.forEach((e,r)=>{const n=t.indexOf(r);-1!=n&&(s[n]=e)}),s},t.wordFrequencyCount=function(e){return e.split(" ").reduce((e,t)=>e.set(t,(e.get(t)||0)+1),new Map)},t.wordFrequencyCountBinary=function(e){return e.split(" ").reduce((e,t)=>e.set(t,1),new Map)},t.getLocale=function(e,t){e=r(e);let s=null;for(const r of t)if(r.includes(e)){s=r[1];break}return null===s?"undefined":s}},21:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(22);t.default=class{constructor(e){this.classifier=e}run(e,t){this.checkPreprocessing(e,t),this.checkPrediction(e,t),this.checkExplanation(e,t)}checkPreprocessing(e,t){const s=r.iterTree(e.tree),n=this.classifier.transform(t);for(const{main:e,extra:i,data:l}of s){const{x:s}=l,{x:o,features:a}=r.getNode(n,e,i);try{this._comparePreprocessing(s,o)}catch(e){for(let e=0;e<o.length;e++)o[e]!==s[e]&&console.log("[31m%s[0m",`i: ${e} (${a[e]}), xPred: ${o[e]}, xTrue: ${s[e]}`);throw console.log(t),e}}}_comparePreprocessing(e,t){if(t.length!==e.length)throw new Error(`Wrong shape (number of features)! xPred: ${t.length}, xTrue: ${e.length}`);for(let s=0;s<t.length;s++)if(t[s]!==e[s])throw new Error("At least one preprocessing value is different")}checkPrediction(e,t){const s=e.y,r=this.classifier.flatPrediction(this.classifier.predict(t));try{for(const e of Object.keys(s)){if(void 0===r[e]&&s[e])throw new Error(`At least '${e}' should be predicted but isn't`);if(void 0!==r[e]&&s[e]!==r[e])throw new Error(`At least '${e}' prediction is different`)}}catch(e){throw console.log("yPred: ",r),console.log("yTrue: ",s),e}}checkExplanation(e,t){const s=this.classifier.explain(t),n=r.iterTree(e.tree);for(const{main:e,extra:t,data:i}of n){const n=null===t?e:t,{shap:l}=i,{expected_value:o,values:a}=l,u=r.getNode(s,e,t),c=u.baseValue,d=Object.keys(u.features).map(e=>u.features[e].effect);try{if(o!==c)throw new Error(`The SHAP expected value is different for label '${n}':\n                                        Pred is ${c}\n                                        True is ${o}`);for(let e=0;e<a.length;e++)if(a[e]!==d[e])throw new Error(`The SHAP value is different for label '${n}' and feature position ${e}:\n                                            Pred is ${d[e]}\n                                            True is ${a[e]}`)}catch(e){throw e}}return!0}}},22:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.delNode=t.setNode=t.getNode=t.iterTree=t.initTree=void 0,t.initTree=(e,t)=>{const s={},r=()=>({data:t(),children:{}});for(const t of Object.keys(e)){s[t]=r();for(const n of Object.keys(e[t]))s[t].children[n]=r()}return s},t.iterTree=function*(e){for(const t of Object.keys(e)){yield{main:t,extra:null,data:e[t].data};for(const s of Object.keys(e[t].children))yield{main:t,extra:s,data:e[t].children[s].data}}},t.getNode=(e,t,s)=>null===s?e[t].data:e[t].children[s].data,t.setNode=(e,t,s,r)=>{null===s?e[t].data=r:e[t].children[s].data=r},t.delNode=(e,t,s)=>{null===s?delete e[t]:delete e[t].children[s]}},23:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(82),n=s(83),i=s(22);t.default=class{constructor(e){this.trainer=e.trainer,this.timestamp=e.timestamp,this.runId=e.run_id,this.hierarchy={};for(const t of Object.keys(e.model)){this.hierarchy[t]={};for(const s of Object.keys(e.model[t].children))this.hierarchy[t][s]={}}this.tree=i.initTree(this.hierarchy,()=>({thesaurus:{},features:[],weights:[],intercept:null,threshold:null,means:[],expectedValue:null,logisticRegression:null,linearExplainer:null}));for(const{main:t,extra:s}of i.iterTree(this.tree)){const l=i.getNode(e.model,t,s),o={};Object.keys(l.weights).forEach(e=>{o[e]=Object.keys(l.weights[e])});const a=[];for(const[e,t]of Object.entries(o))a.push(...t);const u=[];for(const e of Object.values(l.weights))u.push(...Object.values(e));const c=[];for(const e of Object.values(l.shap.means))c.push(...Object.values(e));i.setNode(this.tree,t,s,{thesaurus:o,features:a,weights:u,intercept:l.intercept,threshold:l.threshold,means:c,expectedValue:l.shap.expected_value,logisticRegression:new r.LogisticRegression(u,l.intercept,l.threshold),linearExplainer:new n.LinearExplainer(u,c,l.shap.expected_value)})}}transform(e){const t=i.initTree(this.hierarchy,()=>({x:[],features:[]}));for(const{main:s,extra:r,data:n}of i.iterTree(t)){const t=i.getNode(this.tree,s,r).thesaurus;for(const[s,r]of Object.entries(t))n.x.push(...this.preprocessingMapper[s](r,e)),n.features.push(...r);n.features=i.getNode(this.tree,s,r).features}return t}predict(e){const t=i.initTree(this.hierarchy,()=>null),s=this.transform(e);for(const{main:e,extra:r,data:n}of i.iterTree(s)){if((null===r?e:r)===r&&0===i.getNode(t,e,null)){i.setNode(t,e,r,0);continue}const s=i.getNode(this.tree,e,r).logisticRegression;i.setNode(t,e,r,s.predict(n.x))}return t}smartPredict(e){const t=i.initTree(this.hierarchy,()=>null),s=i.initTree(this.hierarchy,()=>null),r=this.transform(e);for(const{main:e,extra:n,data:l}of i.iterTree(r)){if((null===n?e:n)===n&&0===i.getNode(t,e,null)){i.setNode(t,e,n,0);continue}const r=i.getNode(this.tree,e,n).logisticRegression.predictMargin(l.x),o=r>=0?1:0;i.setNode(t,e,n,o),i.setNode(s,e,n,r)}const n=i.getNode(s,"other",null);return Array.from(i.iterTree(s)).every(({main:e,extra:t,data:s})=>s<n)?i.initTree({other:{}},()=>1):(i.setNode(t,"other",null,0),t)}explain(e){const t=i.initTree(this.hierarchy,()=>({})),s=this.transform(e);for(const{main:e,extra:r,data:n}of i.iterTree(s)){const s=i.getNode(this.tree,e,r),{x:l}=n,o=s.thesaurus,a=[];Object.entries(o).map(e=>{const[t,s]=e;a.push(...s.map(e=>`${t}_${e}`))});const u=Object.assign({},a),c=s.linearExplainer,d=c.shapValues(l),h=[];for(let e=0;e<l.length;e++)h.push({value:l[e],effect:d[e]});i.setNode(t,e,r,{baseValue:c.expectedValue,link:"identity",outNames:[null===r?e:r],featureNames:u,features:h,thres:i.getNode(this.tree,e,r).logisticRegression.t})}return t}flatPrediction(e){const t={};for(const{main:s,extra:r,data:n}of i.iterTree(e)){const e=null===r?s:r;void 0===t[e]?t[e]=n:t[e]=1===t[e]?1:n}return t}toString(e){const t=this.flatPrediction(e);return Object.keys(t).filter(e=>1===t[e]).join(",")}}},24:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LOCALES=void 0,t.LOCALES=[["ENGLISH","en","eng",null],["DANISH","da","dan",null],["DUTCH","nl","dut",null],["FINNISH","fi","fin",null],["FRENCH","fr","fre",null],["GERMAN","de","ger",null],["HEBREW","he","heb",null],["ITALIAN","it","ita",null],["Japanese","ja","jpn",null],["Korean","ko","kor",null],["NORWEGIAN","nb","nor",null],["POLISH","pl","pol",null],["PORTUGUESE","pt","por",null],["RUSSIAN","ru","rus",null],["SPANISH","es","spa",null],["SWEDISH","sv","swe",null],["Chinese","zh","chi","zh-CN"],["CZECH","cs","cze",null],["GREEK","el","gre",null],["ICELANDIC","is","ice",null],["LATVIAN","lv","lav",null],["LITHUANIAN","lt","lit",null],["ROMANIAN","ro","rum",null],["HUNGARIAN","hu","hun",null],["ESTONIAN","et","est",null],["TG_UNKNOWN_LANGUAGE",null,null,"ut"],["Unknown",null,null,"un"],["BULGARIAN","bg","bul",null],["CROATIAN","hr","scr",null],["SERBIAN","sr","scc",null],["IRISH","ga","gle",null],["GALICIAN","gl","glg",null],["TAGALOG",null,"fil",null],["TURKISH","tr","tur",null],["UKRAINIAN","uk","ukr",null],["HINDI","hi","hin",null],["MACEDONIAN","mk","mac",null],["BENGALI","bn","ben",null],["INDONESIAN","id","ind",null],["LATIN","la","lat",null],["MALAY","ms","may",null],["MALAYALAM","ml","mal",null],["WELSH","cy","wel",null],["NEPALI","ne","nep",null],["TELUGU","te","tel",null],["ALBANIAN","sq","alb",null],["TAMIL","ta","tam",null],["BELARUSIAN","be","bel",null],["JAVANESE","jw","jav",null],["OCCITAN","oc","oci",null],["URDU","ur","urd",null],["BIHARI","bh","bih",null],["GUJARATI","gu","guj",null],["THAI","th","tha",null],["ARABIC","ar","ara",null],["CATALAN","ca","cat",null],["ESPERANTO","eo","epo",null],["BASQUE","eu","baq",null],["INTERLINGUA","ia","ina",null],["KANNADA","kn","kan",null],["PUNJABI","pa","pan",null],["SCOTS_GAELIC","gd","gla",null],["SWAHILI","sw","swa",null],["SLOVENIAN","sl","slv",null],["MARATHI","mr","mar",null],["MALTESE","mt","mlt",null],["VIETNAMESE","vi","vie",null],["FRISIAN","fy","fry",null],["SLOVAK","sk","slo",null],["ChineseT",null,"zh-TW",null],["FAROESE","fo","fao",null],["SUNDANESE","su","sun",null],["UZBEK","uz","uzb",null],["AMHARIC","am","amh",null],["AZERBAIJANI","az","aze",null],["GEORGIAN","ka","geo",null],["TIGRINYA","ti","tir",null],["PERSIAN","fa","per",null],["BOSNIAN","bs","bos",null],["SINHALESE","si","sin",null],["NORWEGIAN_N","nn","nno",null],["PORTUGUESE_P",null,null,"pt-PT"],["PORTUGUESE_B",null,null,"pt-BR"],["XHOSA","xh","xho",null],["ZULU","zu","zul",null],["GUARANI","gn","grn",null],["SESOTHO","st","sot",null],["TURKMEN","tk","tuk",null],["KYRGYZ","ky","kir",null],["BRETON","br","bre",null],["TWI","tw","twi",null],["YIDDISH","yi","yid",null],["SERBO_CROATIAN","sh",null,null],["SOMALI","so","som",null],["UIGHUR","ug","uig",null],["KURDISH","ku","kur",null],["MONGOLIAN","mn","mon",null],["ARMENIAN","hy","arm",null],["LAOTHIAN","lo","lao",null],["SINDHI","sd","snd",null],["RHAETO_ROMANCE","rm","roh",null],["AFRIKAANS","af","afr",null],["LUXEMBOURGISH","lb","ltz",null],["BURMESE","my","bur",null],["KHMER","km","khm",null],["TIBETAN","bo","tib",null],["DHIVEHI","dv","div",null],["CHEROKEE",null,"chr",null],["SYRIAC",null,"syr",null],["LIMBU",null,null,"sit-NP"],["ORIYA","or","ori",null],["ASSAMESE","as","asm",null],["CORSICAN","co","cos",null],["INTERLINGUE","ie","ine",null],["KAZAKH","kk","kaz",null],["LINGALA","ln","lin",null],["MOLDAVIAN","mo","mol",null],["PASHTO","ps","pus",null],["QUECHUA","qu","que",null],["SHONA","sn","sna",null],["TAJIK","tg","tgk",null],["TATAR","tt","tat",null],["TONGA","to","tog",null],["YORUBA","yo","yor",null],["CREOLES_AND_PIDGINS_ENGLISH_BASED",null,"cpe",null],["CREOLES_AND_PIDGINS_FRENCH_BASED",null,"cpf",null],["CREOLES_AND_PIDGINS_PORTUGUESE_BASED",null,"cpp",null],["CREOLES_AND_PIDGINS_OTHER",null,"crp",null],["MAORI","mi","mao",null],["WOLOF","wo","wol",null],["ABKHAZIAN","ab","abk",null],["AFAR","aa","aar",null],["AYMARA","ay","aym",null],["BASHKIR","ba","bak",null],["BISLAMA","bi","bis",null],["DZONGKHA","dz","dzo",null],["FIJIAN","fj","fij",null],["GREENLANDIC","kl","kal",null],["HAUSA","ha","hau",null],["HAITIAN_CREOLE","ht",null,null],["INUPIAK","ik","ipk",null],["INUKTITUT","iu","iku",null],["KASHMIRI","ks","kas",null],["KINYARWANDA","rw","kin",null],["MALAGASY","mg","mlg",null],["NAURU","na","nau",null],["OROMO","om","orm",null],["RUNDI","rn","run",null],["SAMOAN","sm","smo",null],["SANGO","sg","sag",null],["SANSKRIT","sa","san",null],["SISWANT","ss","ssw",null],["TSONGA","ts","tso",null],["TSWANA","tn","tsn",null],["VOLAPUK","vo","vol",null],["ZHUANG","za","zha",null],["KHASI",null,"kha",null],["SCOTS",null,"sco",null],["GANDA","lg","lug",null],["MANX","gv","glv",null],["MONTENEGRIN",null,null,"sr-ME"],["XX",null,null,"XX"]]},25:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.countBinaryTokens=t.multiLabelEncoding=t.oneHotEncoding=void 0;const r=s(11);t.oneHotEncoding=(e,t)=>e.map(e=>t===e?1:0),t.multiLabelEncoding=(e,t)=>e.map(e=>t.includes(e)?1:0),t.countBinaryTokens=(e,t)=>{const s=r.wordFrequencyCountBinary(t);return r.buildVectorFromMap(s,e)}},4:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QueryFrameIdMessage=t.IframeExportReportMessage=t.ClassificationReportMessage=t.ToggleDevtoolMessage=t.SetHeavyDocumentOutboundMessage=t.AhoCorasickifyMessage=t.GetTabLanguageMessage=t.GetAllParametersMessage=t.ReclassifyIframeMessage=void 0;class r{constructor(){this.msg=r.MSG}}t.ReclassifyIframeMessage=r,r.MSG="reclassifyIframe";class n{constructor(){this.msg=n.MSG}}t.GetAllParametersMessage=n,n.MSG="getAllParameters";class i{constructor(){this.msg=i.MSG}}t.GetTabLanguageMessage=i,i.MSG="getTabLanguage";class l{constructor(){this.msg=l.MSG}}t.AhoCorasickifyMessage=l,l.MSG="ahoCorasickify";class o{constructor(){this.msg=o.MSG}}t.SetHeavyDocumentOutboundMessage=o,o.MSG="setHeavyDocument";class a{constructor(){this.msg=a.MSG}}t.ToggleDevtoolMessage=a,a.MSG="toggleDevtool";class u{constructor(e){this.formStructure=e,this.msg=u.MSG}}t.ClassificationReportMessage=u,u.MSG="classificationReport";class c{constructor(e){this.report=e,this.msg=c.MSG}}t.IframeExportReportMessage=c,c.MSG="iframeExportReportMessage";class d{constructor(){this.msg=d.MSG}}t.QueryFrameIdMessage=d,d.MSG="queryFrameId"},79:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});new(s(80).TiresiasBackground)},80:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TiresiasBackground=void 0;const n=r(s(81)),i=r(s(85)),l=r(s(86)),o=s(10),a=s(4),u=s(88),c=r(s(89)),d=r(s(90)),h=s(9),f=!0,g=!0;t.TiresiasBackground=class{constructor(){this._ahoCorasickWrapper=new l.default,this._pandora=new d.default,this._devtoolManager=new c.default(!1),this._devtoolManager.listen(),this._registerHandlers(),this.fetchData(u.PREFIX_PATH+"/data/forms_model.json",e=>{const t=new n.default(e);this._pandora.setFormsClassifier(t)},e=>{throw new Error("Form Classifier failed to load: "+e.message)},!0),this.fetchData(u.PREFIX_PATH+"/data/fields_model.json",e=>{const t=new i.default(e);this._pandora.setFieldsClassifier(t)},e=>{throw new Error("Form Classifier failed to load: "+e.message)},!0),u.IS_DEVTOOL_ENABLED&&this._devtoolManager.setPandora(this._pandora),chrome.tabs.onUpdated.addListener((e,t)=>{if("complete"===t.status){this._devtoolManager.isEnabled&&this._devtoolManager.deleteTabId(e);const t=new o.ClassifyMessage;chrome.tabs.sendMessage(e,t,()=>{chrome.runtime.lastError})}}),this._devtoolManager.isEnabled&&chrome.tabs.onRemoved.addListener(e=>{this._devtoolManager.deleteTabId(e)})}fetchData(e,t,s,r){fetch(chrome.runtime.getURL(e),{mode:"same-origin"}).then(e=>e.blob()).then((function(e){const n=new FileReader;n.addEventListener("loadend",(function(){if(t&&"function"==typeof t)if(r)try{if(!this.result)throw new Error("The result of fetch is null");t(JSON.parse(this.result))}catch(e){s(e)}else t(this.result)})),n.readAsText(e)})).catch(e=>{s(e)})}_sendBackHeavyNotificationToAllFrames(e,t,s){if(t.tab&&t.tab.id){const e=new o.SetHeavyDocumentInboundMessage;chrome.tabs.sendMessage(t.tab.id,e),s(null)}return!1}_askFrameToReclassify(e,t,s){if(t.tab&&t.tab.id){const r=new o.ClassifyMessage;chrome.tabs.sendMessage(t.tab.id,r,{frameId:parseInt(e.frameId,10)}),s(null)}return!1}_replyConfiguration(e,t,s){const r=new o.AllParametersMessage;return r.debugMode=f,r.deepFormOutput=g,s(r),!1}_replyTabLanguage(e,t,s){var r;const n=null===(r=t.tab)||void 0===r?void 0:r.id;if(n)return chrome.tabs.detectLanguage(n,e=>{const t=new o.TagLanguageResponseMessage;t.lang=e||"und",s(t)}),!0;throw new Error("_replyTabLanguage message unable to address request")}_ahoCorasickify(e,t,s){const r=e.data,n=["humanReadableProse","attributes","buttonVerbatim"];for(const e of n)e in r&&(r[e]=this._ahoCorasickWrapper.searchAndSplit(r[e]));return s({data:r}),!1}_toggleDevTool(e,t,s){const r=u.IS_DEVTOOL_ENABLED&&e.isDevtoolEnabled;return r||this._devtoolManager.cleanTabStorage(),this._devtoolManager.isEnabled=r,!1}_performClassification(e,t,s){var r;const n=null===(r=t.tab)||void 0===r?void 0:r.id;if(s(e.formStructure.map(e=>this._pandora.predictStructure(e))),n&&this._devtoolManager.isEnabled){const t=e.formStructure.map(e=>this._pandora.explainStructure(e));this._devtoolManager.storeTabFormsStructure(n,t)}return!1}_dispatchIframeReport(e,t,s){var r;const n=null===(r=t.tab)||void 0===r?void 0:r.id;return n&&chrome.tabs.sendMessage(n,new o.DispatchIframeExportReportMessage(e.report)),!1}_respondFrameId(e,t,s){const r=new o.QueryFrameIdResponseMessage;return r.frameId=t.frameId||0,s(r),!1}_registerHandlers(){this._messageHandler=new h.MessageHandler;[{msg:a.SetHeavyDocumentOutboundMessage.MSG,handler:this._sendBackHeavyNotificationToAllFrames},{msg:a.ReclassifyIframeMessage.MSG,handler:this._askFrameToReclassify},{msg:a.GetAllParametersMessage.MSG,handler:this._replyConfiguration},{msg:a.GetTabLanguageMessage.MSG,handler:this._replyTabLanguage},{msg:a.AhoCorasickifyMessage.MSG,handler:this._ahoCorasickify},{msg:a.ToggleDevtoolMessage.MSG,handler:this._toggleDevTool},{msg:a.ClassificationReportMessage.MSG,handler:this._performClassification},{msg:a.IframeExportReportMessage.MSG,handler:this._dispatchIframeReport},{msg:a.QueryFrameIdMessage.MSG,handler:this._respondFrameId}].forEach(e=>{this._messageHandler.addListener(this,e.msg,e.handler)})}}},81:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FormsTester=void 0;const n=r(s(21)),i=r(s(23)),l=s(24),o=s(11),a=s(25);class u extends n.default{}t.FormsTester=u;class c extends i.default{constructor(){super(...arguments),this.preprocessingFieldTypes=(e,t)=>{const s=o.wordFrequencyCount(t.fieldTypes||""),r=new Map;for(let[e,t]of s.entries()){const s=e.slice(0,e.lastIndexOf("_")),n=e.slice(e.lastIndexOf("_")+1,e.length),i=e.charAt(e.length-1);isNaN(Number(i))||(t=Number(n),e=s),r.set(e,t)}return o.buildVectorFromMap(r,e)},this.preprocessingMapper={"form.locale":(e,t)=>a.oneHotEncoding(e,o.getLocale(t.locale,l.LOCALES)),"form.fieldTypes":(e,t)=>a.countBinaryTokens(e,t.fieldTypes||""),"form.humanReadable":(e,t)=>a.countBinaryTokens(e,t.humanReadable||""),"form.attributes":(e,t)=>a.countBinaryTokens(e,t.attributes||""),"form.buttonVerbatim":(e,t)=>a.countBinaryTokens(e,t.buttonVerbatim||""),"form.fieldHumanReadables":(e,t)=>{let s=t.fields.map(e=>e.humanReadable).join(" ");return a.countBinaryTokens(e,s||"")},"form.fieldAttributes":(e,t)=>{let s=t.fields.map(e=>e.attributes).join(" ");return a.countBinaryTokens(e,s||"")}}}}t.default=c},82:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MultiOutputLogisticRegression=t.LogisticRegression=void 0;t.LogisticRegression=class{constructor(e,t,s){this.w=e,this.b=t,this.t=s}predictScore(e){let t=this.b;for(let s=0;s<this.w.length;s++)t+=e[s]*this.w[s];return t}predictMargin(e){let t=this.b-this.t;for(let s=0;s<this.w.length;s++)t+=e[s]*this.w[s];return t}predict(e){return this.predictScore(e)>=this.t?1:0}};t.MultiOutputLogisticRegression=class{constructor(e,t,s){this.W=e,this.b=t,this.t=s}predictScores(e){const t=[];for(let s=0;s<this.W.y;s++){let r=this.b[s];for(let t=0;t<this.W.x;t++)r+=e.get(s,t)*this.W.get(s,t);t.push(r)}return t}predictMargins(e){const t=[];for(let s=0;s<this.W.y;s++){let r=this.b[s]-this.t[s];for(let t=0;t<this.W.x;t++)r+=e.get(s,t)*this.W.get(s,t);t.push(r)}return t}predict(e){const t=this.predictScores(e),s=[];for(let e=0;e<t.length;e++)s.push(t[e]>=this.t[e]?1:0);return s}}},83:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MultiOutputLinearExplainer=t.LinearExplainer=void 0;const n=r(s(84));t.LinearExplainer=class{constructor(e,t,s){this.w=e,this.m=t,this.expectedValue=s}shapValues(e){const t=[];for(let s=0;s<this.w.length;s++)t.push(this.w[s]*(e[s]-this.m[s]));return t}};t.MultiOutputLinearExplainer=class{constructor(e,t,s){this.W=e,this.M=t,this.expectedValues=s,this.outputMatrix=new n.default(t.y,t.x)}shapValues(e){for(let t=0;t<e.y;t++)for(let s=0;s<e.x;s++)this.outputMatrix.set(t,s,this.W.get(t,s)*(e.get(t,s)-this.M.get(t,s)));return this.outputMatrix}}},84:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e,t){this.y=e,this.x=t,this.isTransposed=!1,this.arr=new Float64Array(t*e+1)}static from(e){const t=new r(e.length,e[0].length);for(let s=0;s<e.length;s++){if(t.x!=e[s].length)throw new Error("Matrix: the shape of cols is not constant at row "+s);for(let r=0;r<e[s].length;r++)t.set(s,r,e[s][r])}return t}toString(){let e="";for(let t=0;t<this.y;t++){for(let s=0;s<this.x;s++)e+=this.get(t,s)+" ";e+="\n"}return e}shape(){return{y:this.y,x:this.x}}set(e,t,s){if(e>=this.y||t>=this.x)throw new Error(`(${e}, ${t}) is out of bounds, matrix has shape ${this.shape()}`);this.isTransposed?this.arr[t*this.y+e]=s:this.arr[e*this.x+t]=s}get(e,t){if(e>=this.y||t>=this.x)throw new Error(`(${e}, ${t}) is out of bounds, matrix has shape ${this.shape()}`);return this.isTransposed?this.arr[t*this.y+e]:this.arr[e*this.x+t]}transpose(){const e=this.x;return this.x=this.y,this.y=e,this.isTransposed=!this.isTransposed,this}realoc(e){for(let t=0;t<e.length;t++){if(this.x!=e[t].length)throw new Error("Matrix: the shape of cols is not constant at row "+t);for(let s=0;s<e[t].length;s++)this.set(t,s,e[t][s])}}}t.default=r},85:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FieldsTester=void 0;const n=r(s(23)),i=r(s(21)),l=s(24),o=s(11),a=s(25);class u extends i.default{}t.FieldsTester=u;class c extends n.default{constructor(){super(...arguments),this.preprocessingMapper={"field.locale":(e,t)=>a.oneHotEncoding(e,o.getLocale(t.locale,l.LOCALES)),"field.type":(e,t)=>a.oneHotEncoding(e,t.type),"field.humanReadable":(e,t)=>a.countBinaryTokens(e,t.humanReadable||""),"field.attributes":(e,t)=>a.countBinaryTokens(e,t.attributes||""),"form.classification":(e,t)=>a.multiLabelEncoding(e,t.form.classification.split(",")),"form.humanReadable":(e,t)=>a.countBinaryTokens(e,t.form.humanReadable||""),"form.buttonVerbatim":(e,t)=>a.countBinaryTokens(e,t.form.buttonVerbatim||"")}}}t.default=c},86:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(87));t.default=class{constructor(){this.kDISABLE=!1;this.wrapped=new n.default(["account","birth","change","compte","connect","connexion","cree","creation","create","date","enregistre","enregistrer","enregistrez","enregistrement","first","forgot","identifier","identifiez","identification","inscrire","inscris","inscription","inscrivez","keep","log","oublie","passe","passeport","perdu","premier","register","remember","reset","search","sign","subscribe","user","users","username"])}_search(e,t=!0){return this.wrapped.search(e,t)}searchAndSplit(e){if(this.kDISABLE)return e;return e.split(" ").reduce((e,t)=>{for(;t;){const s=this._search(t,!1);if(!s||!s.length){e.push(t);break}{const r=s[0];r.startOffset&&e.push(t.substring(0,r.startOffset)),e.push(r.needle),t=t.substring(r.endOffset+1)}}return e},[]).join(" ")}}},87:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e){this.mValue=e,this.mChildren=null,this.final=!1}get value(){return this.mValue}get children(){return this.mChildren}get childCount(){return this.mChildren?this.mChildren.length:0}hasChild(e){if(!e)throw Error("AhoCorasickTrieNode::hasChild: invalid value");return!!this.mChildren&&this.mChildren.some(t=>t.value==e)}getChild(e){if(!e)throw Error("AhoCorasickTrieNode::getChild: invalid value");return this.mChildren&&this.mChildren.find(t=>t.value==e)||null}addChild(e){if(!e)throw Error("AhoCorasickTrieNode::addChild: invalid value");if(!e.startsWith(this.value))throw Error("AhoCorasickTrieNode::addChild: unable to add child because value does not start with parent's value");if(e.length!=this.value.length+1)throw Error("AhoCorasickTrieNode::addChild: value has wrong size");this.mChildren||(this.mChildren=[]);const t=new r(e);return this.mChildren.push(t),t}find(e){if(this.value)throw Error("AhoCorasickTrieNode::find: context is not the root of the trie");let t="",s=this;for(let r=0;r<e.length;r++){t+=e[r];const n=s.getChild(t);if(!n)return null;s=n}return s}}t.default=class{constructor(e){if(!Array.isArray(e))throw Error("AhoCorasick::constructor: argument is not an array");this.mTrie=new r(""),e.forEach(e=>{let t=this.mTrie;for(let s=0;s<e.length;s++){const r=e[s];if(t){const e=t.value+r;if(t.hasChild(e))t=t.getChild(e);else{const s=t.addChild(e);t=s}}else t=this.mTrie.addChild(r)}t&&(t.final=!0)})}search(e,t=!0){const s=[];let r=[];for(let t=0;t<e.length;t++){const n=e[t];r.push(this.mTrie);const i=[];r.forEach(e=>{const r=e.value+n,l=e.getChild(r);l&&(i.push(l),l.final&&s.push({needle:l.value,startOffset:t-l.value.length+1,endOffset:t}))}),r=i}return s.sort((e,t)=>e.needle.length>t.needle.length?-1:e.needle.length<t.needle.length||e.endOffset>t.endOffset?1:e.endOffset<t.endOffset?-1:0),t?s:s.reduce((e,t)=>{if(e.length){e.some(e=>t.startOffset<=e.endOffset&&t.endOffset>=e.startOffset)||e.push(t)}else e.push(t);return e},[])}}},88:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IS_DEVTOOL_ENABLED=t.PREFIX_PATH=void 0;t.PREFIX_PATH="/content/tiresias";t.IS_DEVTOOL_ENABLED=!1},89:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e){this.isEnabled=e,this.devtoolsConnection={},this.tabStorage=new Map}setPandora(e){this.pandora=e}listen(){chrome.runtime.onConnect.addListener(e=>{const t=t=>{switch(t.name){case"init":if(!this.isEnabled)return void e.postMessage({name:"disable"});e.postMessage({name:"getClassifications",data:this.tabStorage.get(t.tabId)});break;case"devtoolModelContext":if(!t.data)throw Error("devtoolModelContext message sent without data");e.postMessage({name:"devtoolModelPrediction",data:this.contextPrediction(t.data)})}};e.onMessage.addListener(t),e.onDisconnect.addListener(s=>{s.onMessage.removeListener(t);const r=Object.keys(this.devtoolsConnection);for(let t=0,s=r.length;t<s;t++)if(this.devtoolsConnection[r[t]]==e){delete this.devtoolsConnection[r[t]];break}})})}storeTabFormsStructure(e,t){this.deleteTabId(e),this.tabStorage.set(e,t)}contextPrediction(e){const t={context:e.form,fields:e.fields.map(t=>Object.assign(Object.assign({},t),{form:{humanReadable:e.form.humanReadable,buttonVerbatim:e.form.buttonVerbatim,classification:""}}))};return this.pandora.explainStructure(t)}deleteTabId(e){this.tabStorage.has(e)&&this.tabStorage.delete(e)}cleanTabStorage(){for(const e of this.tabStorage.keys())this.tabStorage.delete(e)}}},9:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageHandler=void 0;t.MessageHandler=class{constructor(e){this._messageListeners=new Map,chrome.runtime.onMessage.addListener((e,t,s)=>this._onSendMessageListener(e,t,s)),e&&e.addEventListener("message",e=>this._onPostMessageListener(e))}_onPostMessageListener(e){const t=e.data;if(!t||!this._messageListeners.has(t.msg))return;this._messageListeners.get(t.msg)(t,e.origin,e.source)}_onSendMessageListener(e,t,s){if(!e||!this._messageListeners.has(e.msg))return!1;return this._messageListeners.get(e.msg)(e,t,s)}addListener(e,t,s){if(this._messageListeners.has(t))throw new Error("MessageHandler::addListener:: a listener already exists for message "+t);this._messageListeners.set(t,s.bind(e))}}},90:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{setFormsClassifier(e){this.formsClassifier=e}setFieldsClassifier(e){this.fieldsClassifier=e}predictStructure(e){const t=this.formsClassifier.toString(this.formsClassifier.smartPredict(e.context));return{classification:t||"other",fields:e.fields.map(e=>(e.form.classification=t,this.fieldsClassifier.toString(this.fieldsClassifier.smartPredict(e))||"other"))}}explainStructure(e){const t=this.formsClassifier.smartPredict(e.context),s=this.formsClassifier.toString(t);return{form:{classification:s||"nothing",prediction:t,explanation:this.formsClassifier.explain(e.context),context:e.context},fields:e.fields.map(e=>{const t=this.fieldsClassifier.smartPredict(e);return e.form.classification=s,{classification:this.fieldsClassifier.toString(t)||"nothing",prediction:t,explanation:this.fieldsClassifier.explain(e),context:e}})}}}}})}));